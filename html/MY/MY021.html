<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CM020</title>
    <link rel="stylesheet" href="../../assets/css/swiper.css" />
    <link rel="stylesheet" href="../../assets/css/common-ui.css" />
    <link rel="stylesheet" href="../../assets/css/style.css" />
  </head>
  <body>
    <div class="page">
      <div class="container">
        <header class="header">
          <!-- header.html 로 페이지 통합 관리 -->
        </header>

        <main class="contents">
          <div class="content">
            <section class="main-banner">
              <figure class="img-box">
                <img src="../../assets/imgs/img/img-CM010-1.jpg" alt="" />
              </figure>
              <div class="text-box">
                <h2 class="title">추천 루트</h2>
                <p class="txt">
                  다른 반려인들이 다녀온 루트를 그대로 따라 해보세요!
                </p>
                <div class="guide-arrow" aria-label="하단에 컨텐츠가 있습니다">
                  <i></i>
                  <i></i>
                </div>
              </div>
            </section>

            <section class="map-content-area">
              <div class="inner">
                <div class="title-box">
                  <h2 class="title">내 루트 수정하기</h2>
                  <p class="txt">조금만 더 꾸며볼까요?</p>
                </div>

                <div
                  class="function-box -gray-case"
                  style="display: flex; gap: 40px; align-items: flex-start"
                >
                  <div class="following-path" style="flex: 2">
                    <div class="scrolling swiper-wrapper">
                      <ul class="swiper-slide">
                        <li>
                          <strong>로켓 호텔</strong>
                          <dl>
                            <dt>주소</dt>
                            <dd>서울시 송파구</dd>
                            <dt>전화</dt>
                            <dd>02-0000-0000</dd>
                            <dt>날짜</dt>
                            <dd>2025-04-17</dd>
                            <dt>시간</dt>
                            <dd>오전 11:30</dd>
                          </dl>
                        </li>
                        <li>
                          <strong>봄날 카페</strong>
                          <dl>
                            <dt>주소</dt>
                            <dd>서울시 강북구</dd>
                            <dt>전화</dt>
                            <dd>02-0000-0000</dd>
                            <dt>날짜</dt>
                            <dd>2025-04-17</dd>
                            <dt>시간</dt>
                            <dd>오후 02:30</dd>
                          </dl>
                        </li>
                        <li>
                          <strong>꾸러기 애견 캠핑</strong>
                          <dl>
                            <dt>주소</dt>
                            <dd>서울시 강남구</dd>
                            <dt>전화</dt>
                            <dd>02-0000-0000</dd>
                            <dt>날짜</dt>
                            <dd>2025-04-17</dd>
                            <dt>시간</dt>
                            <dd>오전 08:00</dd>
                          </dl>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <!-- 가운데 맵 -->
                  <div
                    style="
                      flex: 1;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                    "
                  >
                    <div
                      id="map"
                      class="map-box"
                      style="
                        width: 350px;
                        height: 350px;
                        border-radius: 16px;
                        box-shadow: 0 2px 8px #0001;
                      "
                    ></div>
                  </div>
                  <!-- 오른쪽 입력 폼 -->
                  <div
                    class="post-form"
                    style="flex: 1; max-width: 400px; margin-left: 40px"
                  >
                    <form id="placeForm" enctype="multipart/form-data">
                      <div style="margin-bottom: 32px">
                        <label for="name" style="font-weight: bold"
                          >장소 이름</label
                        >
                        <input
                          id="name"
                          name="name"
                          type="text"
                          placeholder="장소 이름을 입력해 주세요"
                          style="
                            width: 100%;
                            margin-top: 8px;
                            padding: 12px 10px;
                            border: 1px solid #ddd;
                            border-radius: 8px;
                            font-size: 1em;
                          "
                        />
                      </div>
                      <div style="margin-bottom: 32px">
                        <label for="image" style="font-weight: bold"
                          >이미지 파일</label
                        >
                        <input
                          id="image"
                          name="image"
                          type="file"
                          style="display: block; margin-top: 8px"
                        />
                      </div>
                      <div style="margin-bottom: 32px">
                        <label for="description" style="font-weight: bold"
                          >설명</label
                        >
                        <textarea
                          id="description"
                          name="description"
                          rows="5"
                          placeholder="설명을 입력해 주세요"
                          style="
                            width: 100%;
                            margin-top: 8px;
                            padding: 12px 10px;
                            border: 1px solid #ddd;
                            border-radius: 8px;
                            font-size: 1em;
                          "
                        ></textarea>
                      </div>
                      <!-- 필요시 버튼 추가 가능 -->
                    </form>
                  </div>
                </div>
              </div>
              <div
                style="
                  display: flex;
                  gap: 24px;
                  margin: 48px auto 0 auto;
                  justify-content: center;
                  width: fit-content;
                "
              >
                <button
                  type="button"
                  id="editBtn"
                  style="
                    background: #fff6cc;
                    color: #222;
                    font-weight: bold;
                    padding: 20px 48px;
                    border: none;
                    border-radius: 12px;
                    font-size: 1.3em;
                    cursor: pointer;
                  "
                >
                  수정하기
                </button>
                <button
                  type="button"
                  id="completeBtn"
                  style="
                    background: #ffd600;
                    color: #222;
                    font-weight: bold;
                    padding: 20px 48px;
                    border: none;
                    border-radius: 12px;
                    font-size: 1.3em;
                    cursor: pointer;
                  "
                >
                  작성완료
                </button>
                <button
                  type="button"
                  id="goListBtn"
                  style="
                    background: #fff6cc;
                    color: #222;
                    font-weight: bold;
                    padding: 20px 48px;
                    border: none;
                    border-radius: 12px;
                    font-size: 1.3em;
                    cursor: pointer;
                  "
                >
                  목록으로
                </button>
              </div>
            </section>
          </div>
        </main>

        <footer class="footer">
          <!-- footer.html 로 페이지 통합 관리 -->
        </footer>
      </div>
    </div>

    <div class="modal -login-modal"></div>

    <div id="imgView1" class="modal">
      <div class="container">
        <header class="header">
          <div class="inner">
            <button type="button" class="close" onclick="modalClose()">
              <span class="hide">닫기</span>
            </button>
          </div>
        </header>

        <main class="contents">
          <div class="content">
            <div class="img-view-box">
              <img src="../../assets/imgs/temp/temp1.png" alt="" />
            </div>
          </div>
        </main>
      </div>
    </div>

    <div id="imgView2" class="modal">
      <div class="container">
        <header class="header">
          <div class="inner">
            <button type="button" class="close" onclick="modalClose()">
              <span class="hide">닫기</span>
            </button>
          </div>
        </header>

        <main class="contents">
          <div class="content">
            <div class="img-view-box">
              <img src="../../assets/imgs/temp/bigbigbig.jpg" alt="" />
            </div>
          </div>
        </main>
      </div>
    </div>

    <div id="imgView3" class="modal">
      <div class="container">
        <header class="header">
          <div class="inner">
            <button type="button" class="close" onclick="modalClose()">
              <span class="hide">닫기</span>
            </button>
          </div>
        </header>

        <main class="contents">
          <div class="content">
            <div class="img-view-box">
              <img src="../../assets/imgs/temp/temp-event-page1.jpg" alt="" />
            </div>
          </div>
        </main>
      </div>
    </div>

    <script src="../../assets/libs/jquery/jquery-3.6.0.min.js"></script>
    <script src="../../assets/libs/jquery-ui/jquery-ui.min.js"></script>
    <script src="../../assets/libs/jquery-ui/jquery.ui.touch-punch.min.js"></script>
    <script src="../../assets/libs/swiper/dist/js/swiper.min.js"></script>
    <script src="../../assets/libs/sweetalert2/sweetalert2.js"></script>
    <script src="../../assets/js/style.js"></script>
    <script src="../../assets/js/dev.js"></script>
    <script src="../../assets/js/map.js"></script>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=9921046766278baaca9a7d657feaf033&libraries=services"
    ></script>
    <script>
      mapSeting();

      document
        .getElementById("placeForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const res = await fetch("http://localhost:8080/places", {
            method: "POST",
            body: formData,
          });
          const result = await res.json();
          alert(result.message);
          window.location.href = "../MY/MY030.html"; // 글 목록 페이지로 이동
        });

      // 이미지 미리보기 기능
      const imageInput = document.querySelector('input[type="file"]');
      imageInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            // 이미지 미리보기를 upload-gallery에 추가
            const imgBox = document.createElement("div");
            imgBox.className = "img-box";
            imgBox.innerHTML = `
              <button type="button" class="img-view">
                <img src="${e.target.result}" alt="" />
              </button>
              <button type="button" class="close" onclick="this.parentElement.remove()">
                <span class="hide">사진 삭제</span>
              </button>
            `;
            document.querySelector(".upload-gallery").appendChild(imgBox);
          };
          reader.readAsDataURL(file);
        }
      });

      document.getElementById("completeBtn").onclick = async function () {
        const name = document.getElementById("name").value;
        const description = document.getElementById("description").value;
        const imageInput = document.getElementById("image");
        let imageUrl = "";
        // 1. 이미지 업로드
        if (imageInput.files[0]) {
          const formData = new FormData();
          formData.append("image", imageInput.files[0]);
          const res = await fetch("http://localhost:8080/uploads", {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          imageUrl = data.imageUrl;
        }
        // 2. 글 정보 JSON으로 저장
        await fetch("http://localhost:8080/place", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, description, imageUrl }),
        });
        window.location.href = "MY030.html";
      };
      document.getElementById("goListBtn").onclick = function () {
        window.location.href = "MY020.html";
      };
    </script>
  </body>
</html>
